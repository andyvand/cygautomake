dist: $(DIST_FILES) $(DIST_DIRS) distname
	rm -rf `cat distname`; mkdir `cat distname`
	@for file in $(DIST_FILES); do \
	  echo linking $$file; \
	  ln $(srcdir)/$$file `cat distname`/$$file || \
	    { echo copying $$file instead; cp -p $(srcdir)/$$file `cat distname`/$$file;}; \
	done
	for subdir in $(SUBDIRS); do \
	  (cd $$subdir; $(MAKE) subdir=$$subdir $@); done
	chmod -R a+r `cat distname`
	tar -chozf `cat distname`.tar.gz `cat distname`
	rm -rf `cat distname` distname

