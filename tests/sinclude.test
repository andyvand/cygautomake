#! /bin/sh

# Test to see if `m4_sinclude' works.

. $srcdir/defs || exit 1

# Overwrite configure.in, because the default uses `sinclude' as package
# name and this play havoc with Autoconf on some platforms (`sinclude'
# is an m4 macro).
cat > configure.in <<EOF
AC_INIT([amsinclude], [1.0])
AM_INIT_AUTOMAKE
AC_CONFIG_FILES([Makefile])
EOF

mkdir sub
cat > sub/p.m4 << 'END'
AC_SUBST(MAGICALPIG)
END

: > Makefile.am

$ACLOCAL || exit 1
echo 'm4_sinclude(sub/p.m4)' >> aclocal.m4

$AUTOMAKE --Wno-error || exit 1

grep MAGICALPIG Makefile.in
