#! /bin/sh

# Test for bug in `make dist'
# From Pavel Roskin.

. $srcdir/defs || exit 1

cat > configure.in << 'END'
AC_INIT
AM_INIT_AUTOMAKE(foo, 0.1)
AC_OUTPUT(Makefile)
END

cat > Makefile.am << 'END'
SUBDIRS = .
END

# Remove some dummy files added by defs.
rm -f install-sh mkinstalldirs missing

# Fail gracefully if no autoconf.
(autoconf --version) > /dev/null 2>&1 || exit 0

# Likewise for gzip.
(gzip --version) > /dev/null 2>&1 || exit 0

$ACLOCAL || exit 1
autoconf || exit 1
$AUTOMAKE -a || exit 1

chmod 000 Makefile.am

./configure || exit 1
$MAKE dist  || exit 1

gunzip foo-0.1.tar.gz || exit 1
tar tf foo-0.1.tar | fgrep Makefile.am
