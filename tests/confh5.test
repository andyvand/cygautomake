#! /bin/sh

# Make sure that calling AM_CONFIG_HEADER or AC_CONFIG_HEADERS
# before AM_INIT_AUTOMAKE is not allowed and that the error
# message says so.

. $srcdir/defs || exit 1

cat > configure.in << 'END'
AC_INIT(nonesuch, nonesuch)
AC_CONFIG_HEADERS(config.h)
AM_INIT_AUTOMAKE
AC_OUTPUT
END

: > config.h.in

$ACLOCAL || exit 1
# Autoconf (at least up to 2.53) treats this error as a warning.
# Hence we don't `&& exit 1'.
$AUTOCONF >output 2>&1
cat output
grep 'AC_CONFIG_HEADERS.*before.*AM_INIT_AUTOMAKE' output || exit 1


cat > configure.in << 'END'
AC_INIT(nonesuch, nonesuch)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE
AC_OUTPUT
END

$ACLOCAL || exit 1
$AUTOCONF >output 2>&1 && exit 1
cat output
grep 'AM_CONFIG_HEADER.*before.*AM_INIT_AUTOMAKE' output || exit 1
