#! /bin/sh

# Check dirlist support.
# This test relies on m4/dirlist

. $srcdir/defs || exit 1

set -e

cat > configure.in <<EOF
AC_INIT
AM_INIT_GUILE_MODULE
EOF

mkdir dirlist-test

cat >dirlist-test/dirlist-check.m4 <<'END'
AC_DEFUN([AM_INIT_GUILE_MODULE],[
. $srcdir/../GUILE-VERSION
AM_INIT_AUTOMAKE($PACKAGE, $VERSION)
AC_CONFIG_AUX_DIR(..)
module=[$1]
AC_SUBST(module)])
END

cat >dirlist-test/init.m4 <<EOF
AC_DEFUN([AM_INIT_AUTOMAKE], [I should not be included])
EOF

$ACLOCAL
grep 'DEFUN.*AM_INIT_GUILE_MODULE' aclocal.m4

# This bug can occur only when we do a VPATH build of Automake
# (beause of the `-I' passed to aclocal in tests/defs) but it's
# ok because this is what `make distcheck' does.
grep 'I should not be included' aclocal.m4 && exit 1

:
